#!/usr/bin/env node
"use strict";

var _path = require("path");
var _fs = require("fs");
var _index = require("./index");
var _utils = require("./utils");
var argv = require('minimist')(process.argv.slice(2));
var args = argv._;
if (args.length !== 1) {
  console.log(argv);
  console.warn('Usage: pgsql-parser <sqlfile>');
  process.exit(1);
}
var pth = args[0].startsWith('/') ? args[0] : (0, _path.resolve)((0, _path.join)(process.cwd(), args[0]));
var content = (0, _fs.readFileSync)(pth, 'utf-8');
var query;
if (argv.pl) {
  // plpgsql ONLY
  query = (0, _index.parseFunction)(content);
} else {
  query = (0, _index.parse)(content);
}
process.stdout.write(JSON.stringify((0, _utils.cleanTreeWithStmt)(query), null, 2));